<!doctype html><html lang=en dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Streaming Partial JSON from LLMs in Go | deepankar.log</title><meta name=keywords content="go,LLM,json,streaming,godantic"><meta name=description content="How to parse incomplete JSON as it streams from LLM APIs"><meta name=author content="Deepankar Mahapatro"><link rel=canonical href=https://deepankarm.github.io/posts/streaming-partial-json-llm/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://deepankarm.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://deepankarm.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://deepankarm.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://deepankarm.github.io/apple-touch-icon.png><link rel=mask-icon href=https://deepankarm.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://deepankarm.github.io/posts/streaming-partial-json-llm/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "09cbd7674917411283ca3c61ea31135d"}'></script><meta property="og:url" content="https://deepankarm.github.io/posts/streaming-partial-json-llm/"><meta property="og:site_name" content="deepankar.log"><meta property="og:title" content="Streaming Partial JSON from LLMs in Go"><meta property="og:description" content="How to parse incomplete JSON as it streams from LLM APIs"><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-12-14T18:00:00+05:30"><meta property="article:modified_time" content="2025-12-14T18:00:00+05:30"><meta property="article:tag" content="Go"><meta property="article:tag" content="LLM"><meta property="article:tag" content="Json"><meta property="article:tag" content="Streaming"><meta property="article:tag" content="Godantic"><meta name=twitter:card content="summary"><meta name=twitter:title content="Streaming Partial JSON from LLMs in Go"><meta name=twitter:description content="How to parse incomplete JSON as it streams from LLM APIs"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://deepankarm.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Streaming Partial JSON from LLMs in Go","item":"https://deepankarm.github.io/posts/streaming-partial-json-llm/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Streaming Partial JSON from LLMs in Go","name":"Streaming Partial JSON from LLMs in Go","description":"How to parse incomplete JSON as it streams from LLM APIs","keywords":["go","LLM","json","streaming","godantic"],"articleBody":" The Problem LLMs stream JSON token by token. Your structured output arrives as:\n{\"project\": {\"name\": \"Mo {\"project\": {\"name\": \"Mobile App\", \"status\": \"in_prog {\"project\": {\"name\": \"Mobile App\", \"status\": \"in_progress\"}, \"tasks\": [{\"title\": \"UI Redes ... Standard encoding/json fails on every chunk except the last:\njson.Unmarshal([]byte(`{\"project\": {\"name\": \"Mo`), \u0026result) // error: unexpected end of JSON input This was recently highlighted by swyx as a #1 or #2 performance issue in AI applications. Youâ€™re forced to wait for the complete response before showing anything to users - negating the entire point of streaming with json mode or structured output.\nğŸ“„ View full demo code View code on GitHub Gist\npackage main import ( \"encoding/json\" \"fmt\" \"math/rand\" \"time\" ) type Task struct { Title string `json:\"title\"` Status string `json:\"status\"` Priority string `json:\"priority\"` } type Project struct { Name string `json:\"name\"` Status string `json:\"status\"` } type Response struct { Project Project `json:\"project\"` Tasks []Task `json:\"tasks\"` Summary string `json:\"summary\"` Score float64 `json:\"score\"` } func randomSleep() { ms := 10 + rand.Intn(91) // 10-100ms time.Sleep(time.Duration(ms) * time.Millisecond) } func main() { rand.Seed(time.Now().UnixNano()) chunks := []string{ `{\"project\":`, ` {\"name\": \"Mo`, `bile App\", \"`, `status\": \"in`, `_progress\"},`, ` \"tasks\": [{`, `\"title\": \"UI`, ` Redesign\",`, ` \"status\": \"`, `done\", \"prio`, `rity\": \"high`, `\"}, {\"title\"`, `: \"API Inte`, `gration\", \"s`, `tatus\": \"in_`, `progress\", \"`, `priority\": \"`, `medium\"}], \"`, `summary\": \"P`, `roject is on`, ` track with `, `good progres`, `s.\", \"score\"`, `: 0.85}`, } fmt.Println(\"â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\") fmt.Println(\"â•‘ encoding/json - Parsing Streaming LLM Output â•‘\") fmt.Println(\"â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\") fmt.Println() fmt.Println(\"Waiting for valid JSON...\") fmt.Println() var buffer string var result Response startTime := time.Now() var timeToFirstOutput time.Duration for i, chunk := range chunks { buffer += chunk randomSleep() err := json.Unmarshal([]byte(buffer), \u0026result) if err == nil { timeToFirstOutput = time.Since(startTime) fmt.Print(\"\\033[2J\\033[H\") // Clear screen fmt.Println(\"â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\") fmt.Println(\"â•‘ encoding/json - Parsing Streaming LLM Output â•‘\") fmt.Println(\"â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\") fmt.Println() fmt.Printf(\"âœ… COMPLETE - Chunk %d/%d (final chunk)\\n\", i+1, len(chunks)) fmt.Println() prettyJSON, _ := json.MarshalIndent(result, \"\", \" \") fmt.Println(string(prettyJSON)) } } fmt.Println() fmt.Println(\"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\") fmt.Printf(\"Total chunks received: %d\\n\", len(chunks)) fmt.Printf(\"Time to first output: %v\\n\", timeToFirstOutput.Round(time.Millisecond)) fmt.Println() fmt.Println(\"âš ï¸ No output until the final chunk!\") } The Solution godantic provides StreamParser - a streaming JSON parser that repairs incomplete JSON, tracks which fields are still coming, and validates on the fly.\nparser := godantic.NewStreamParser[Response]() for chunk := range llmStream { result, state, _ := parser.Feed(chunk) if state.IsComplete { fmt.Println(\"Done:\", result) } else { // Shows: [\"project.status\", \"tasks[1].title\", ...] fmt.Printf(\"Waiting for: %v\\n\", state.WaitingFor()) } } With godantic: nested fields populate in real-time as tokens arrive.\nTime to first output drops from seconds to milliseconds - youâ€™re no longer waiting for the complete response. This is a simple example, but the gains are significant for long generations where users would otherwise stare at a blank screen.\nğŸ“„ View full demo code View code on GitHub Gist\npackage main import ( \"encoding/json\" \"fmt\" \"math/rand\" \"time\" \"github.com/deepankarm/godantic/pkg/godantic\" ) type Task struct { Title string `json:\"title\"` Status string `json:\"status\"` Priority string `json:\"priority\"` } type Project struct { Name string `json:\"name\"` Status string `json:\"status\"` } type Response struct { Project Project `json:\"project\"` Tasks []Task `json:\"tasks\"` Summary string `json:\"summary\"` Score float64 `json:\"score\"` } func (r *Response) FieldScore() godantic.FieldOptions[float64] { return godantic.Field( godantic.Default(0.5), godantic.Min(0.0), godantic.Max(1.0), ) } func randomSleep() { ms := 10 + rand.Intn(91) // 10-100ms time.Sleep(time.Duration(ms) * time.Millisecond) } func main() { rand.Seed(time.Now().UnixNano()) chunks := []string{ `{\"project\":`, ` {\"name\": \"Mo`, `bile App\", \"`, `status\": \"in`, `_progress\"},`, ` \"tasks\": [{`, `\"title\": \"UI`, ` Redesign\",`, ` \"status\": \"`, `done\", \"prio`, `rity\": \"high`, `\"}, {\"title\"`, `: \"API Inte`, `gration\", \"s`, `tatus\": \"in_`, `progress\", \"`, `priority\": \"`, `medium\"}], \"`, `summary\": \"P`, `roject is on`, ` track with `, `good progres`, `s.\", \"score\"`, `: 0.85}`, } parser := godantic.NewStreamParser[Response]() startTime := time.Now() var timeToFirstOutput time.Duration updateCount := 0 for i, chunk := range chunks { randomSleep() result, state, _ := parser.Feed([]byte(chunk)) if result == nil { continue } updateCount++ if timeToFirstOutput == 0 { timeToFirstOutput = time.Since(startTime) } fmt.Print(\"\\033[2J\\033[H\") // Clear screen fmt.Println(\"â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\") fmt.Println(\"â•‘ godantic.StreamParser - Real-time Streaming â•‘\") fmt.Println(\"â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\") fmt.Println() fmt.Printf(\"Chunk %2d/%d received\\n\", i+1, len(chunks)) fmt.Println() if state.IsComplete { fmt.Println(\"âœ… COMPLETE - All fields received and validated\") } else { waiting := state.WaitingFor() if len(waiting) \u003e 0 { fmt.Printf(\"â³ STREAMING - Waiting for: %s\\n\", waiting[0]) if len(waiting) \u003e 1 { fmt.Printf(\" (and %d more fields)\\n\", len(waiting)-1) } } } fmt.Println() currentJSON, _ := json.MarshalIndent(result, \"\", \" \") fmt.Println(string(currentJSON)) } totalTime := time.Since(startTime) fmt.Println() fmt.Println(\"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\") fmt.Printf(\"Total chunks received: %d\\n\", len(chunks)) fmt.Printf(\"Screen updates: %d\\n\", updateCount) fmt.Printf(\"Time to first output: %v\\n\", timeToFirstOutput.Round(time.Millisecond)) fmt.Printf(\"Total time: %v\\n\", totalTime.Round(time.Millisecond)) } How It Works Repairs incomplete JSON - closes unclosed strings, arrays, objects at any nesting level Tracks incomplete fields - state.WaitingFor() returns paths like [\"project.name\", \"tasks[1].status\"] Skips validation for incomplete fields - no false errors mid-stream Applies defaults automatically - sensible fallbacks while data streams The parser accumulates chunks internally, so each Feed() call returns the current best-effort parse of everything received so far.\nTyped Schemas for LLMs godantic also generates JSON schemas from your Go types - useful for LLM structured output:\ntype Response struct { Project Project `json:\"project\"` Tasks []Task `json:\"tasks\"` Summary string `json:\"summary\"` Score float64 `json:\"score\"` } func (r *Response) FieldScore() godantic.FieldOptions[float64] { return godantic.Field( godantic.Default(0.5), godantic.Min(0.0), godantic.Max(1.0), ) } // Generate schema for Gemini/OpenAI/Anthropic schemaGen := schema.NewGenerator[Response]() jsonSchema, err := schemaGen.GenerateFlattened() The same types work for schema generation and streaming parse - one definition, used everywhere.\nTry It go get github.com/deepankarm/godantic See the streaming example for a complete working demo with Gemini.\n","wordCount":"894","inLanguage":"en","datePublished":"2025-12-14T18:00:00+05:30","dateModified":"2025-12-14T18:00:00+05:30","author":{"@type":"Person","name":"Deepankar Mahapatro"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://deepankarm.github.io/posts/streaming-partial-json-llm/"},"publisher":{"@type":"Organization","name":"deepankar.log","logo":{"@type":"ImageObject","url":"https://deepankarm.github.io/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://deepankarm.github.io/ accesskey=h title="deepankar.log (Alt + H)">deepankar.log</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://deepankarm.github.io/ title=Home><span>Home</span></a></li><li><a href=https://deepankarm.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://deepankarm.github.io/about/ title=About><span>About</span></a></li><li><a href=https://github.com/deepankarm title=GitHub><span>GitHub</span>&nbsp;
<svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://www.linkedin.com/in/deepankar-mahapatro/ title=LinkedIn><span>LinkedIn</span>&nbsp;
<svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Streaming Partial JSON from LLMs in Go</h1><div class=post-description>How to parse incomplete JSON as it streams from LLM APIs</div><div class=post-meta><span title='2025-12-14 18:00:00 +0530 +0530'>December 14, 2025</span>&nbsp;Â·&nbsp;<span>5 min</span>&nbsp;Â·&nbsp;<span>Deepankar Mahapatro</span></div></header><div class=post-content><hr><h2 id=the-problem>The Problem<a hidden class=anchor aria-hidden=true href=#the-problem>#</a></h2><p>LLMs stream JSON token by token. Your structured output arrives as:</p><pre tabindex=0><code>{&#34;project&#34;: {&#34;name&#34;: &#34;Mo
{&#34;project&#34;: {&#34;name&#34;: &#34;Mobile App&#34;, &#34;status&#34;: &#34;in_prog
{&#34;project&#34;: {&#34;name&#34;: &#34;Mobile App&#34;, &#34;status&#34;: &#34;in_progress&#34;}, &#34;tasks&#34;: [{&#34;title&#34;: &#34;UI Redes
...
</code></pre><p>Standard <code>encoding/json</code> fails on every chunk except the last:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Unmarshal</span>([]byte(<span style=color:#e6db74>`{&#34;project&#34;: {&#34;name&#34;: &#34;Mo`</span>), <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>result</span>)
</span></span><span style=display:flex><span><span style=color:#75715e>// error: unexpected end of JSON input</span>
</span></span></code></pre></div><p>This was recently highlighted by <a href=https://x.com/swyx>swyx</a> as <a href=https://x.com/swyx/status/2000071124051451993>a #1 or #2 performance issue</a> in AI applications. You&rsquo;re forced to wait for the complete response before showing anything to users - negating the entire point of streaming with json mode or structured output.</p><p align=center><img src=/images/streaming-json/encoding-json.gif alt="encoding/json fails" width=90%></p><details><summary><strong>ğŸ“„ View full demo code</strong></summary><p><a href=https://gist.github.com/deepankarm/b02492bfb458765b8e143664a3d788e6>View code on GitHub Gist</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;encoding/json&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;math/rand&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;time&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Task</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Title</span>    <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;title&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Status</span>   <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;status&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Priority</span> <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;priority&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Project</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Name</span>   <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;name&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Status</span> <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;status&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Response</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Project</span> <span style=color:#a6e22e>Project</span> <span style=color:#e6db74>`json:&#34;project&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Tasks</span>   []<span style=color:#a6e22e>Task</span>  <span style=color:#e6db74>`json:&#34;tasks&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Summary</span> <span style=color:#66d9ef>string</span>  <span style=color:#e6db74>`json:&#34;summary&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Score</span>   <span style=color:#66d9ef>float64</span> <span style=color:#e6db74>`json:&#34;score&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>randomSleep</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ms</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>10</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>rand</span>.<span style=color:#a6e22e>Intn</span>(<span style=color:#ae81ff>91</span>) <span style=color:#75715e>// 10-100ms</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Duration</span>(<span style=color:#a6e22e>ms</span>) <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Millisecond</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>rand</span>.<span style=color:#a6e22e>Seed</span>(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Now</span>().<span style=color:#a6e22e>UnixNano</span>())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>chunks</span> <span style=color:#f92672>:=</span> []<span style=color:#66d9ef>string</span>{
</span></span><span style=display:flex><span>		<span style=color:#e6db74>`{&#34;project&#34;:`</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>` {&#34;name&#34;: &#34;Mo`</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>`bile App&#34;, &#34;`</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>`status&#34;: &#34;in`</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>`_progress&#34;},`</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>` &#34;tasks&#34;: [{`</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>`&#34;title&#34;: &#34;UI`</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>` Redesign&#34;,`</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>` &#34;status&#34;: &#34;`</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>`done&#34;, &#34;prio`</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>`rity&#34;: &#34;high`</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>`&#34;}, {&#34;title&#34;`</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>`: &#34;API Inte`</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>`gration&#34;, &#34;s`</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>`tatus&#34;: &#34;in_`</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>`progress&#34;, &#34;`</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>`priority&#34;: &#34;`</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>`medium&#34;}], &#34;`</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>`summary&#34;: &#34;P`</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>`roject is on`</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>` track with `</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>`good progres`</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>`s.&#34;, &#34;score&#34;`</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>`: 0.85}`</span>,
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;â•‘  encoding/json - Parsing Streaming LLM Output              â•‘&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Waiting for valid JSON...&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>buffer</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>result</span> <span style=color:#a6e22e>Response</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>startTime</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Now</span>()
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>timeToFirstOutput</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Duration</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>chunk</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>chunks</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>buffer</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>chunk</span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>randomSleep</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Unmarshal</span>([]byte(<span style=color:#a6e22e>buffer</span>), <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>result</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>timeToFirstOutput</span> = <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Since</span>(<span style=color:#a6e22e>startTime</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Print</span>(<span style=color:#e6db74>&#34;\033[2J\033[H&#34;</span>) <span style=color:#75715e>// Clear screen</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—&#34;</span>)
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;â•‘  encoding/json - Parsing Streaming LLM Output              â•‘&#34;</span>)
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•&#34;</span>)
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>()
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;âœ… COMPLETE - Chunk %d/%d (final chunk)\n&#34;</span>, <span style=color:#a6e22e>i</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>, len(<span style=color:#a6e22e>chunks</span>))
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>prettyJSON</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>MarshalIndent</span>(<span style=color:#a6e22e>result</span>, <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#e6db74>&#34;  &#34;</span>)
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(string(<span style=color:#a6e22e>prettyJSON</span>))
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Total chunks received:    %d\n&#34;</span>, len(<span style=color:#a6e22e>chunks</span>))
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Time to first output:     %v\n&#34;</span>, <span style=color:#a6e22e>timeToFirstOutput</span>.<span style=color:#a6e22e>Round</span>(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Millisecond</span>))
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;âš ï¸  No output until the final chunk!&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></details><hr><h2 id=the-solution>The Solution<a hidden class=anchor aria-hidden=true href=#the-solution>#</a></h2><p><a href=https://github.com/deepankarm/godantic>godantic</a> provides <code>StreamParser</code> - a streaming JSON parser that repairs incomplete JSON, tracks which fields are still coming, and validates on the fly.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>parser</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>godantic</span>.<span style=color:#a6e22e>NewStreamParser</span>[<span style=color:#a6e22e>Response</span>]()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> <span style=color:#a6e22e>chunk</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>llmStream</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>result</span>, <span style=color:#a6e22e>state</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>parser</span>.<span style=color:#a6e22e>Feed</span>(<span style=color:#a6e22e>chunk</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>IsComplete</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Done:&#34;</span>, <span style=color:#a6e22e>result</span>)
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Shows: [&#34;project.status&#34;, &#34;tasks[1].title&#34;, ...]</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Waiting for: %v\n&#34;</span>, <span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>WaitingFor</span>())
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p align=center><img src=/images/streaming-json/godantic-streaming.gif alt="godantic streaming" width=90%></p><p><em>With godantic: nested fields populate in real-time as tokens arrive.</em></p><p>Time to first output drops from seconds to milliseconds - you&rsquo;re no longer waiting for the complete response. This is a simple example, but the gains are significant for long generations where users would otherwise stare at a blank screen.</p><details><summary><strong>ğŸ“„ View full demo code</strong></summary><p><a href=https://gist.github.com/deepankarm/c208a57282dc89eb4f17175f9c91d9dc>View code on GitHub Gist</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;encoding/json&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;math/rand&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;time&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;github.com/deepankarm/godantic/pkg/godantic&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Task</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Title</span>    <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;title&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Status</span>   <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;status&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Priority</span> <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;priority&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Project</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Name</span>   <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;name&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Status</span> <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;status&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Response</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Project</span> <span style=color:#a6e22e>Project</span> <span style=color:#e6db74>`json:&#34;project&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Tasks</span>   []<span style=color:#a6e22e>Task</span>  <span style=color:#e6db74>`json:&#34;tasks&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Summary</span> <span style=color:#66d9ef>string</span>  <span style=color:#e6db74>`json:&#34;summary&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Score</span>   <span style=color:#66d9ef>float64</span> <span style=color:#e6db74>`json:&#34;score&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Response</span>) <span style=color:#a6e22e>FieldScore</span>() <span style=color:#a6e22e>godantic</span>.<span style=color:#a6e22e>FieldOptions</span>[<span style=color:#66d9ef>float64</span>] {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>godantic</span>.<span style=color:#a6e22e>Field</span>(
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>godantic</span>.<span style=color:#a6e22e>Default</span>(<span style=color:#ae81ff>0.5</span>),
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>godantic</span>.<span style=color:#a6e22e>Min</span>(<span style=color:#ae81ff>0.0</span>),
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>godantic</span>.<span style=color:#a6e22e>Max</span>(<span style=color:#ae81ff>1.0</span>),
</span></span><span style=display:flex><span>	)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>randomSleep</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ms</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>10</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>rand</span>.<span style=color:#a6e22e>Intn</span>(<span style=color:#ae81ff>91</span>) <span style=color:#75715e>// 10-100ms</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Duration</span>(<span style=color:#a6e22e>ms</span>) <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Millisecond</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>rand</span>.<span style=color:#a6e22e>Seed</span>(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Now</span>().<span style=color:#a6e22e>UnixNano</span>())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>chunks</span> <span style=color:#f92672>:=</span> []<span style=color:#66d9ef>string</span>{
</span></span><span style=display:flex><span>		<span style=color:#e6db74>`{&#34;project&#34;:`</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>` {&#34;name&#34;: &#34;Mo`</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>`bile App&#34;, &#34;`</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>`status&#34;: &#34;in`</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>`_progress&#34;},`</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>` &#34;tasks&#34;: [{`</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>`&#34;title&#34;: &#34;UI`</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>` Redesign&#34;,`</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>` &#34;status&#34;: &#34;`</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>`done&#34;, &#34;prio`</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>`rity&#34;: &#34;high`</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>`&#34;}, {&#34;title&#34;`</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>`: &#34;API Inte`</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>`gration&#34;, &#34;s`</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>`tatus&#34;: &#34;in_`</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>`progress&#34;, &#34;`</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>`priority&#34;: &#34;`</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>`medium&#34;}], &#34;`</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>`summary&#34;: &#34;P`</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>`roject is on`</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>` track with `</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>`good progres`</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>`s.&#34;, &#34;score&#34;`</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>`: 0.85}`</span>,
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>parser</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>godantic</span>.<span style=color:#a6e22e>NewStreamParser</span>[<span style=color:#a6e22e>Response</span>]()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>startTime</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Now</span>()
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>timeToFirstOutput</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Duration</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>updateCount</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>chunk</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>chunks</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>randomSleep</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>result</span>, <span style=color:#a6e22e>state</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>parser</span>.<span style=color:#a6e22e>Feed</span>([]byte(<span style=color:#a6e22e>chunk</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>updateCount</span><span style=color:#f92672>++</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>timeToFirstOutput</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>timeToFirstOutput</span> = <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Since</span>(<span style=color:#a6e22e>startTime</span>)
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Print</span>(<span style=color:#e6db74>&#34;\033[2J\033[H&#34;</span>) <span style=color:#75715e>// Clear screen</span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—&#34;</span>)
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;â•‘  godantic.StreamParser - Real-time Streaming               â•‘&#34;</span>)
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•&#34;</span>)
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Chunk %2d/%d received\n&#34;</span>, <span style=color:#a6e22e>i</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>, len(<span style=color:#a6e22e>chunks</span>))
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>IsComplete</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;âœ… COMPLETE - All fields received and validated&#34;</span>)
</span></span><span style=display:flex><span>		} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>waiting</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>WaitingFor</span>()
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>waiting</span>) &gt; <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;â³ STREAMING - Waiting for: %s\n&#34;</span>, <span style=color:#a6e22e>waiting</span>[<span style=color:#ae81ff>0</span>])
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>waiting</span>) &gt; <span style=color:#ae81ff>1</span> {
</span></span><span style=display:flex><span>					<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;              (and %d more fields)\n&#34;</span>, len(<span style=color:#a6e22e>waiting</span>)<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>currentJSON</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>MarshalIndent</span>(<span style=color:#a6e22e>result</span>, <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#e6db74>&#34;  &#34;</span>)
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(string(<span style=color:#a6e22e>currentJSON</span>))
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>totalTime</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Since</span>(<span style=color:#a6e22e>startTime</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Total chunks received:    %d\n&#34;</span>, len(<span style=color:#a6e22e>chunks</span>))
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Screen updates:           %d\n&#34;</span>, <span style=color:#a6e22e>updateCount</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Time to first output:     %v\n&#34;</span>, <span style=color:#a6e22e>timeToFirstOutput</span>.<span style=color:#a6e22e>Round</span>(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Millisecond</span>))
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Total time:               %v\n&#34;</span>, <span style=color:#a6e22e>totalTime</span>.<span style=color:#a6e22e>Round</span>(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Millisecond</span>))
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></details><hr><h2 id=how-it-works>How It Works<a hidden class=anchor aria-hidden=true href=#how-it-works>#</a></h2><ol><li><strong>Repairs incomplete JSON</strong> - closes unclosed strings, arrays, objects at any nesting level</li><li><strong>Tracks incomplete fields</strong> - <code>state.WaitingFor()</code> returns paths like <code>["project.name", "tasks[1].status"]</code></li><li><strong>Skips validation for incomplete fields</strong> - no false errors mid-stream</li><li><strong>Applies defaults automatically</strong> - sensible fallbacks while data streams</li></ol><p>The parser accumulates chunks internally, so each <code>Feed()</code> call returns the current best-effort parse of everything received so far.</p><hr><h2 id=typed-schemas-for-llms>Typed Schemas for LLMs<a hidden class=anchor aria-hidden=true href=#typed-schemas-for-llms>#</a></h2><p>godantic also generates JSON schemas from your Go types - useful for LLM structured output:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Response</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Project</span>  <span style=color:#a6e22e>Project</span>  <span style=color:#e6db74>`json:&#34;project&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Tasks</span>    []<span style=color:#a6e22e>Task</span>   <span style=color:#e6db74>`json:&#34;tasks&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Summary</span>  <span style=color:#66d9ef>string</span>   <span style=color:#e6db74>`json:&#34;summary&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Score</span>    <span style=color:#66d9ef>float64</span>  <span style=color:#e6db74>`json:&#34;score&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Response</span>) <span style=color:#a6e22e>FieldScore</span>() <span style=color:#a6e22e>godantic</span>.<span style=color:#a6e22e>FieldOptions</span>[<span style=color:#66d9ef>float64</span>] {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>godantic</span>.<span style=color:#a6e22e>Field</span>(
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>godantic</span>.<span style=color:#a6e22e>Default</span>(<span style=color:#ae81ff>0.5</span>),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>godantic</span>.<span style=color:#a6e22e>Min</span>(<span style=color:#ae81ff>0.0</span>),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>godantic</span>.<span style=color:#a6e22e>Max</span>(<span style=color:#ae81ff>1.0</span>),
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Generate schema for Gemini/OpenAI/Anthropic</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>schemaGen</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>schema</span>.<span style=color:#a6e22e>NewGenerator</span>[<span style=color:#a6e22e>Response</span>]()
</span></span><span style=display:flex><span><span style=color:#a6e22e>jsonSchema</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>schemaGen</span>.<span style=color:#a6e22e>GenerateFlattened</span>()
</span></span></code></pre></div><p>The same types work for schema generation and streaming parse - one definition, used everywhere.</p><hr><h2 id=try-it>Try It<a hidden class=anchor aria-hidden=true href=#try-it>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>go get github.com/deepankarm/godantic
</span></span></code></pre></div><p>See the <a href=https://github.com/deepankarm/godantic/blob/main/examples/llm-partialjson-streaming/main.go>streaming example</a> for a complete working demo with Gemini.</p><hr></div><footer class=post-footer><ul class=post-tags><li><a href=https://deepankarm.github.io/tags/go/>Go</a></li><li><a href=https://deepankarm.github.io/tags/llm/>LLM</a></li><li><a href=https://deepankarm.github.io/tags/json/>Json</a></li><li><a href=https://deepankarm.github.io/tags/streaming/>Streaming</a></li><li><a href=https://deepankarm.github.io/tags/godantic/>Godantic</a></li></ul><nav class=paginav><a class=prev href=https://deepankarm.github.io/posts/openai-compatibility-paradox/><span class=title>Â« Prev</span><br><span>The OpenAI Compatibility Paradox</span>
</a><a class=next href=https://deepankarm.github.io/posts/jina-linkerd/><span class=title>Next Â»</span><br><span>Jina ğŸ¤ Linkerd</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2026 <a href=https://deepankarm.github.io/>deepankar.log</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>