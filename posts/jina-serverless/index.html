<!doctype html><html lang=en dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Jina ‚ù§Ô∏è Serverless | deepankar.log</title><meta name=keywords content="jina,serverless,knative,kubernetes"><meta name=description content="Serverless experimentation with Jina"><meta name=author content="Deepankar Mahapatro"><link rel=canonical href=https://deepankarm.github.io/posts/jina-serverless/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://deepankarm.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://deepankarm.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://deepankarm.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://deepankarm.github.io/apple-touch-icon.png><link rel=mask-icon href=https://deepankarm.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://deepankarm.github.io/posts/jina-serverless/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "09cbd7674917411283ca3c61ea31135d"}'></script><meta property="og:url" content="https://deepankarm.github.io/posts/jina-serverless/"><meta property="og:site_name" content="deepankar.log"><meta property="og:title" content="Jina ‚ù§Ô∏è Serverless"><meta property="og:description" content="Serverless experimentation with Jina"><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-06-15T17:49:55+05:30"><meta property="article:modified_time" content="2022-06-15T17:49:55+05:30"><meta property="article:tag" content="jina"><meta property="article:tag" content="serverless"><meta property="article:tag" content="knative"><meta property="article:tag" content="kubernetes"><meta name=twitter:card content="summary"><meta name=twitter:title content="Jina ‚ù§Ô∏è Serverless"><meta name=twitter:description content="Serverless experimentation with Jina"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"posts","item":"https://deepankarm.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Jina ‚ù§Ô∏è Serverless","item":"https://deepankarm.github.io/posts/jina-serverless/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Jina ‚ù§Ô∏è Serverless","name":"Jina ‚ù§Ô∏è Serverless","description":"Serverless experimentation with Jina","keywords":["jina","serverless","knative","kubernetes"],"articleBody":" What is Jina? From the Docs\nJina is a framework that empowers anyone to build cross-modal and multi-modal applications on the cloud.\nWhat is serverless? From Wikipedia\nServerless computing is a cloud computing execution model in which the cloud provider allocates machine resources on demand, taking care of the servers on behalf of their customers.\nAlso,\n‚ÄúServerless‚Äù is a misnomer in the sense that servers are still used by cloud service providers to execute code for developers. However, developers of serverless applications are not concerned with capacity planning, configuration, management, maintenance, fault tolerance, or scaling of containers, VMs, or physical servers.\nWhy do the Jina users care? No headache of setting the right number of replicas. Scale-to-0 saves a lot of cost, especially when you‚Äôre starting to host your app. Many use cases in Jina doesn‚Äôt need Executors or Gateway to be always alive. Serverless allows invocations to be ‚Äúevent-driven‚Äù. What is this demo about? We‚Äôll use Knative serving along with Linkerd service mesh \u0026 show\nHow does serverless work in a K8S world? How simple it is to enable autoscaling (from 0 to N) in jina? Why Knative? Knative allows us to scale from 0 to N, based on\nconcurrency or rps. Set min / max number of replicas per deployment. Supports HPA (Resource metric based 1-to-N scaling provided by K8S) as well. Easily integrate with many Ingress controllers. Demo As a first step, please clone jina-serverless-demo, which has the necessary scripts for the demo.\nSet-up You can skip this step if you already have a k8s cluster \u0026 setup knative / linkerd components.\nLet‚Äôs start by setting up a local environment where serverless machinery can be demonstrated. Following script installs\nkubectl, kind \u0026 linkerd CLI, if not already installed. A local kind cluster named jina-serverless. Knative components Kourier Ingress for Knative Linkerd components Patch Knative \u0026 Kourier deployments with Linkerd service-mesh. Read this awesome doc! bash setup.sh Define an Executor \u0026 a Flow Let‚Äôs write a dummy HeavyExecutor which sleeps for 3 seconds every time it receives a new request. This can be replaced with any Executor from Jina Hub.\n# HeavyExecutor/executor.py from jina import DocumentArray, Executor, requests class HeavyExecutor(Executor): @requests def foo(self, docs: DocumentArray, **kwargs): time.sleep(3) # flow.yml jtype: Flow executors: - name: heavy_executor uses: jinahub+docker://HeavyExecutor Convert Flow to K8S yaml Now that we have the setup done, let‚Äôs use the jina CLI to export a dummy Flow yaml into K8S specific yamls.\n$ jina export kubernetes flow.yml jina-sls --k8s-namespace jina-sls # K8s yaml files have been created under jina-sls. You can use it by running kubectl apply -R -f jina-sls $ tree jina-sls jina-sls ‚îú‚îÄ‚îÄ gateway ‚îÇ ‚îî‚îÄ‚îÄ gateway.yml ‚îî‚îÄ‚îÄ heavy_executor ‚îî‚îÄ‚îÄ heavy-executor.yml Convert to Knative yaml This step is temporary and will be implemented as a feature in Jina.\nKnative doesn‚Äôt understand K8S Deployment \u0026 Service resources and implements a Service resource under serving.knative.dev/v1 CRD. Let‚Äôs convert the K8S yamls to Knative yamls using a helper script.\nkubectl create namespace jina-sls kubectl apply -R -f $(python kn/change_to_kn.py jina-sls) We might need to wait a bit until all knative objects are setup in addition to the deployments in jina-sls namespace. Before any Client sends requests to the Gateway, let‚Äôs check \u0026 wait until each deployment has 0 replicas.\nGateway URL To check the URL of the Gateway, you can use the following command.\n$ kubectl get ksvc -n jina-sls gateway --no-headers -o custom-columns=\"URL:.status.url\" http://gateway.jina-sls.127.0.0.1.sslip.io Note that, the URL here is provided by Knative \u0026 hence starts with http. But it is a polyglot Gateway \u0026 accepts all 3 protocols of requests supported by jina (gRPC, WebSockets \u0026 HTTP), just by passing the right URL scheme.\nLet‚Äôs send requests to the Flow that doesn‚Äôt exist! Alright. It took a lot of setup, but now we are ready to see what the fuss is about serverless.\nLet‚Äôs send just 1 request using jina.Client \u0026 keep an eye on the number of replicas per deployment.\nfrom jina import Client, DocumentArray Client(host='grpc://gateway.jina-sls.127.0.0.1.sslip.io').post( on='/', inputs=DocumentArray.empty(2) ) We can observe new replicas popping up for both gateway \u0026 heavy-executor after request is sent via the Client.\nNow, let‚Äôs start 10 concurrent Clients that will send requests to the Gateway.\npython load.py 10 Note the following.\nAs soon as we run the load.py script with 10 concurrent clients, new replicas of the gateway \u0026 heavy-executor start spawning. After a cool down period, all deployments reach the original state of 0 replicas each. So what? Whew! Unfortunately, that was a lot of text. I‚Äôll try to pull up a few dashboards for the next blog.\nWorry only about the code, and let Knative handle the scaling. Best of both worlds - containers + serverless, with 0 headache for the developer. Pipeline of invocations with gRPC, REST or Websocket Gateways. Does your indexing workload get triggered by Events? Think serverless. Go, scale your multimodal application using Jina!\n","wordCount":"812","inLanguage":"en","datePublished":"2022-06-15T17:49:55+05:30","dateModified":"2022-06-15T17:49:55+05:30","author":{"@type":"Person","name":"Deepankar Mahapatro"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://deepankarm.github.io/posts/jina-serverless/"},"publisher":{"@type":"Organization","name":"deepankar.log","logo":{"@type":"ImageObject","url":"https://deepankarm.github.io/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://deepankarm.github.io/ accesskey=h title="deepankar.log (Alt + H)">deepankar.log</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://deepankarm.github.io/ title=Home><span>Home</span></a></li><li><a href=https://deepankarm.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://deepankarm.github.io/about/ title=About><span>About</span></a></li><li><a href=https://github.com/deepankarm title=GitHub><span>GitHub</span>&nbsp;
<svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://www.linkedin.com/in/deepankar-mahapatro/ title=LinkedIn><span>LinkedIn</span>&nbsp;
<svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Jina ‚ù§Ô∏è Serverless</h1><div class=post-description>Serverless experimentation with Jina</div><div class=post-meta><span title='2022-06-15 17:49:55 +0530 +0530'>June 15, 2022</span>&nbsp;¬∑&nbsp;<span>4 min</span>&nbsp;¬∑&nbsp;<span>Deepankar Mahapatro</span></div></header><div class=post-content><hr><h2 id=what-is-jina>What is Jina?<a hidden class=anchor aria-hidden=true href=#what-is-jina>#</a></h2><p>From the <a href=https://docs.jina.ai/>Docs</a></p><blockquote><p>Jina is a framework that empowers anyone to build cross-modal and multi-modal applications on the cloud.</p></blockquote><hr><h2 id=what-is-serverless>What is serverless?<a hidden class=anchor aria-hidden=true href=#what-is-serverless>#</a></h2><p>From <a href=https://en.wikipedia.org/wiki/Serverless_computing>Wikipedia</a></p><blockquote><p>Serverless computing is a cloud computing execution model in which the cloud provider allocates machine resources on demand, taking care of the servers on behalf of their customers.</p></blockquote><p>Also,</p><blockquote><p>&ldquo;Serverless&rdquo; is a misnomer in the sense that servers are still used by cloud service providers to execute code for developers. However, developers of serverless applications are not concerned with capacity planning, configuration, management, maintenance, fault tolerance, or scaling of containers, VMs, or physical servers.</p></blockquote><hr><h2 id=why-do-the-jina-users-care>Why do the Jina users care?<a hidden class=anchor aria-hidden=true href=#why-do-the-jina-users-care>#</a></h2><ul><li>No headache of setting the <a href=https://docs.jina.ai/how-to/scale-out/#scale-out-your-executor>right number of replicas</a>.</li><li>Scale-to-0 saves a lot of cost, especially when you&rsquo;re starting to host your app.</li><li>Many use cases in Jina doesn&rsquo;t need <a href=https://docs.jina.ai/fundamentals/executor/>Executors</a> or <a href=https://docs.jina.ai/fundamentals/gateway/>Gateway</a> to be always alive.</li><li>Serverless allows invocations to be &ldquo;event-driven&rdquo;.</li></ul><hr><h2 id=what-is-this-demo-about>What is this demo about?<a hidden class=anchor aria-hidden=true href=#what-is-this-demo-about>#</a></h2><p>We&rsquo;ll use <a href=https://knative.dev/docs/>Knative serving</a> along with <a href=https://linkerd.io/2.11/overview/>Linkerd service mesh</a> & show</p><ul><li>How does serverless work in a K8S world?</li><li>How simple it is to enable autoscaling (from 0 to N) in jina?</li></ul><hr><h2 id=why-knative>Why Knative?<a hidden class=anchor aria-hidden=true href=#why-knative>#</a></h2><p>Knative allows us to scale from 0 to N, based on</p><ul><li><a href=https://knative.dev/docs/serving/autoscaling/concurrency/>concurrency</a> or <a href=https://knative.dev/docs/serving/autoscaling/rps-target/>rps</a>.</li><li>Set min / max number of replicas per deployment.</li><li>Supports <a href=https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/>HPA</a> (Resource metric based 1-to-N scaling provided by K8S) as well.</li><li>Easily integrate with many Ingress controllers.</li></ul><hr><h2 id=demo>Demo<a hidden class=anchor aria-hidden=true href=#demo>#</a></h2><p>As a first step, please clone <a href=https://github.com/deepankarm/jina-serverless-demo.git>jina-serverless-demo</a>, which has the necessary scripts for the demo.</p><h3 id=set-up>Set-up<a hidden class=anchor aria-hidden=true href=#set-up>#</a></h3><blockquote><p>You can skip this step if you already have a k8s cluster & setup knative / linkerd components.</p></blockquote><p>Let&rsquo;s start by setting up a local environment where serverless machinery can be demonstrated. Following script installs</p><ul><li><code>kubectl</code>, <code>kind</code> & <code>linkerd</code> CLI, if not already installed.</li><li>A local <code>kind</code> cluster named <code>jina-serverless</code>.</li><li><code>Knative</code> components</li><li><code>Kourier</code> Ingress for Knative</li><li><code>Linkerd</code> components</li><li>Patch <code>Knative</code> & <code>Kourier</code> deployments with <code>Linkerd</code> service-mesh. <a href=https://linkerd.io/2020/03/23/serverless-service-mesh-with-knative-and-linkerd/>Read this awesome doc!</a></li></ul><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>bash setup.sh
</span></span></code></pre></div><hr><h3 id=define-an-executor--a-flow>Define an Executor & a Flow<a hidden class=anchor aria-hidden=true href=#define-an-executor--a-flow>#</a></h3><p>Let&rsquo;s write a dummy <code>HeavyExecutor</code> which sleeps for 3 seconds every time it receives a new request. This can be replaced with any Executor from <a href=https://hub.jina.ai/>Jina Hub</a>.</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#7f848e># HeavyExecutor/executor.py</span>
</span></span><span style=display:flex><span><span style=color:#c678dd>from</span> <span style=color:#e06c75>jina</span> <span style=color:#c678dd>import</span> <span style=color:#e06c75>DocumentArray</span>, <span style=color:#e06c75>Executor</span>, <span style=color:#e06c75>requests</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>class</span> <span style=color:#e5c07b>HeavyExecutor</span>(<span style=color:#e06c75>Executor</span>):
</span></span><span style=display:flex><span>    <span style=color:#61afef>@requests</span>
</span></span><span style=display:flex><span>    <span style=color:#c678dd>def</span> <span style=color:#61afef;font-weight:700>foo</span>(<span style=color:#e5c07b>self</span>, <span style=color:#e06c75>docs</span>: <span style=color:#e06c75>DocumentArray</span>, <span style=color:#56b6c2>**</span><span style=color:#e06c75>kwargs</span>):
</span></span><span style=display:flex><span>        <span style=color:#e06c75>time</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>sleep</span>(<span style=color:#d19a66>3</span>)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#7f848e># flow.yml</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>jtype</span>: Flow
</span></span><span style=display:flex><span><span style=color:#e06c75>executors</span>:
</span></span><span style=display:flex><span>  - <span style=color:#e06c75>name</span>: heavy_executor
</span></span><span style=display:flex><span>    <span style=color:#e06c75>uses</span>: jinahub+docker://HeavyExecutor
</span></span></code></pre></div><hr><h3 id=convert-flow-to-k8s-yaml>Convert Flow to K8S yaml<a hidden class=anchor aria-hidden=true href=#convert-flow-to-k8s-yaml>#</a></h3><p>Now that we have the setup done, let&rsquo;s use the jina CLI to export a dummy Flow yaml into K8S specific yamls.</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>$ jina <span style=color:#e5c07b>export</span> kubernetes flow.yml jina-sls --k8s-namespace jina-sls
</span></span><span style=display:flex><span><span style=color:#7f848e># K8s yaml files have been created under jina-sls. You can use it by running kubectl apply -R -f jina-sls</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ tree jina-sls
</span></span><span style=display:flex><span>jina-sls
</span></span><span style=display:flex><span>‚îú‚îÄ‚îÄ gateway
</span></span><span style=display:flex><span>‚îÇ   ‚îî‚îÄ‚îÄ gateway.yml
</span></span><span style=display:flex><span>‚îî‚îÄ‚îÄ heavy_executor
</span></span><span style=display:flex><span>    ‚îî‚îÄ‚îÄ heavy-executor.yml
</span></span></code></pre></div><hr><h3 id=convert-to-knative-yaml>Convert to Knative yaml<a hidden class=anchor aria-hidden=true href=#convert-to-knative-yaml>#</a></h3><blockquote><p>This step is temporary and will be implemented as a <a href=https://github.com/jina-ai/jina/issues/4924>feature</a> in Jina.</p></blockquote><p>Knative doesn&rsquo;t understand K8S <code>Deployment</code> & <code>Service</code> resources and implements a <code>Service</code> resource under <code>serving.knative.dev/v1</code> CRD. Let&rsquo;s convert the K8S yamls to Knative yamls using a helper script.</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl create namespace jina-sls
</span></span><span style=display:flex><span>kubectl apply -R -f <span style=color:#c678dd>$(</span>python kn/change_to_kn.py jina-sls<span style=color:#c678dd>)</span>
</span></span></code></pre></div><p>We might need to wait a bit until all knative objects are setup in addition to the deployments in <code>jina-sls</code> namespace. Before any Client sends requests to the Gateway, let&rsquo;s check & wait until each deployment has 0 replicas.</p><p align=center><a href=#><img src=/images/wait-until-0.png alt="0 replicas" width=60%></a></p><hr><h3 id=gateway-url>Gateway URL<a hidden class=anchor aria-hidden=true href=#gateway-url>#</a></h3><p>To check the URL of the Gateway, you can use the following command.</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get ksvc -n jina-sls gateway --no-headers -o custom-columns<span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;URL:.status.url&#34;</span>
</span></span><span style=display:flex><span>http://gateway.jina-sls.127.0.0.1.sslip.io
</span></span></code></pre></div><p>Note that, the URL here is provided by Knative & hence starts with <code>http</code>. But it is a polyglot Gateway & accepts all 3 protocols of requests supported by jina (gRPC, WebSockets & HTTP), just by passing the right <a href="https://docs.jina.ai/fundamentals/flow/client/#connect:~:text=You%20can%20define%20these%20parameters%20by%20passing%20a%20valid%20URI%20scheme%20as%20part%20of%20the%20host%20argument%3A">URL scheme</a>.</p><hr><h3 id=lets-send-requests-to-the-flow-that-doesnt-exist>Let&rsquo;s send requests to the Flow that doesn&rsquo;t exist!<a hidden class=anchor aria-hidden=true href=#lets-send-requests-to-the-flow-that-doesnt-exist>#</a></h3><p>Alright. It took a lot of setup, but now we are ready to see what the fuss is about serverless.</p><p>Let&rsquo;s send just 1 request using <code>jina.Client</code> & keep an eye on the number of replicas per deployment.</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#c678dd>from</span> <span style=color:#e06c75>jina</span> <span style=color:#c678dd>import</span> <span style=color:#e06c75>Client</span>, <span style=color:#e06c75>DocumentArray</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>Client</span>(<span style=color:#e06c75>host</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#39;grpc://gateway.jina-sls.127.0.0.1.sslip.io&#39;</span>)<span style=color:#56b6c2>.</span><span style=color:#e06c75>post</span>(
</span></span><span style=display:flex><span>    <span style=color:#e06c75>on</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#39;/&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>inputs</span><span style=color:#56b6c2>=</span><span style=color:#e06c75>DocumentArray</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>empty</span>(<span style=color:#d19a66>2</span>)
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><p>We can observe new replicas popping up for both <code>gateway</code> & <code>heavy-executor</code> after request is sent via the Client.</p><p align=center><a href=#><img src=/images/1-request.gif alt="Scale from 0" width=90%></a></p><p>Now, let&rsquo;s start 10 concurrent Clients that will send requests to the Gateway.</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>python load.py <span style=color:#d19a66>10</span>
</span></span></code></pre></div><p>Note the following.</p><ul><li>As soon as we run the <code>load.py</code> script with 10 concurrent clients, new replicas of the <code>gateway</code> & <code>heavy-executor</code> start spawning.</li><li>After a cool down period, all deployments reach the original state of 0 replicas each.</li></ul><p align=center><a href=#><img src=/images/scale-to-10.gif alt="Scale to 10" width=90%></a></p><hr><h2 id=so-what>So what?<a hidden class=anchor aria-hidden=true href=#so-what>#</a></h2><p>Whew! Unfortunately, that was a lot of text. I&rsquo;ll try to pull up a few dashboards for the next blog.</p><ul><li>Worry only about the code, and let Knative handle the scaling.</li><li>Best of both worlds - containers + serverless, with 0 headache for the developer.</li><li>Pipeline of invocations with gRPC, REST or Websocket Gateways.</li><li>Does your indexing workload get triggered by Events? Think serverless.</li></ul><p>Go, scale your multimodal application using Jina!</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://deepankarm.github.io/tags/jina/>jina</a></li><li><a href=https://deepankarm.github.io/tags/serverless/>serverless</a></li><li><a href=https://deepankarm.github.io/tags/knative/>knative</a></li><li><a href=https://deepankarm.github.io/tags/kubernetes/>kubernetes</a></li></ul><nav class=paginav><a class=prev href=https://deepankarm.github.io/posts/jina-linkerd/><span class=title>¬´ Prev</span><br><span>Jina ü§ù Linkerd</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2026 <a href=https://deepankarm.github.io/>deepankar.log</a></span> ¬∑
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>